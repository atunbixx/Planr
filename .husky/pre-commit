#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ğŸ”’ Schema Protection Check
echo "ğŸ” Running schema protection check..."

# Check if schema.prisma was modified
if git diff --cached --name-only | grep -q "prisma/schema.prisma"; then
  echo "ğŸ“ Prisma schema changes detected - running validation..."
  
  # Run schema validation
  if ! npm run schema:validate; then
    echo ""
    echo "âŒ Schema validation failed!"
    echo "ğŸ”§ Please fix the schema issues above before committing."
    echo "ğŸ’¡ Tip: Check for missing @map directives or snake_case field names."
    exit 1
  fi
  
  # Create automatic backup of the working schema
  npm run schema:backup
  echo "ğŸ“‹ Schema backup created automatically."
fi

echo "âœ… Schema protection check passed!"